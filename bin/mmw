#!/bin/bash

# shellcheck source=/dev/null
source "$HOME/.config/mmw.config"

help(){
  echo "Welcome to MMW"
  echo "Usage: mmw [option]"
  echo "Options: "
  echo "  run 'mmw-config runTests' first "
}

setProj(){
 sed -i "s|PROJ=.*|PROJ=$1|g" "$HOME/.config/mmw.config"
}

setProjLoc(){
  sed -i "s|PROJLOC=.*|PROJLOC=$1|g" "$HOME/.config/mmw.config"
}

setArtist(){
  sed -i "s|ARTIST=.*|ARTIST=$1|g" "$HOME/.config/mmw.config"
}

setTempo(){
  sed -i "s|TEMPO=.*|TEMPO=$1|g" "$HOME/.config/mmw.config"
}

setStartTime(){
  sed -i "s|START_TIME=.*|START_TIME=$1|g" "$HOME/.config/mmw.config"
}

setDur(){
  sed -i "s|DUR=.*|DUR=$1|g" "$HOME/.config/mmw.config"
  sed -i "s|LENGTH=.*|LENGTH=$1|g" "$HOME/.config/mmw.config"
}

mkProjDir(){
  mkdir "$PROJPATH"
}

mkStemsDir(){
  mkdir "$HOME/audio/$ARTIST/$PROJ/stems"
}

displayProj(){
  echo "$PROJPATH"
}

createProj(){
  if [ -d "$HOME/audio/" ]; then
      echo "audio directory exists"
  else
    mkdir -p "$HOME/audio/"
    echo " audio directory created"
  fi

  if [ -d "$PROJLOC" ]; then
      echo "Project location directory exists"
  else
    mkdir -p "$PROJLOC"
    echo " Project location directory created"
  fi

  if [ -d "$HOME/audio/$ARTIST" ]; then
      echo "Artist directory exists"
  else
    mkdir -p "$HOME/audio/$ARTIST";
    echo "Artist directory created"
  fi
  
  if [ -d "$PROJPATH" ]; then
    echo "Directory exists"
  else
    read -rp "$PROJPATH does not exist. Do you want to create it? (y/n): " choice
      if [[ $choice == "y" ]]; then
        mkdir "$PROJPATH"
        mkdir "$PROJPATH"/score
        mkdir "$PROJPATH"/.bin
        mkdir "$PROJPATH"/session
        mkdir "$PROJPATH"/sound-design
        echo "$PROJ created"
      else
        echo "$PROJ not created"
      fi
   fi

  if [ ! -d "$HOME/audio/$ARTIST/$PROJ" ]; then
     mkdir "$HOME/audio/$ARTIST/$PROJ"
     mkdir "$HOME/audio/$ARTIST/$PROJ/stems"
     ffmpeg -f lavfi -i anullsrc=channel_layout=stereo:sample_rate=48000 -t 5 "$HOME/audio/$ARTIST/$PROJ/stems/input_1.wav"
  fi

}

"$@"
